<!-- Alertas de Inventario -->
<div class="h-full bg-white rounded-lg shadow-sm border border-gray-200/50 p-6 flex flex-col">
  <div class="mb-6">
    <h3 class="text-lg font-semibold text-gray-900">Alertas de Inventario</h3>
    <p class="text-sm text-gray-600">Productos con stock bajo o sin rotación</p>
  </div>

  <!-- Stock Crítico -->
  <div class="mb-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="flex items-center gap-2">
        <i class="pi pi-exclamation-triangle text-red-600"></i>
        <span class="font-medium text-red-900">Stock Crítico</span>
      </div>
      <span
        class="inline-block bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full"
      >
        {{ loading ? '...' : (alertas?.stockCritico?.totalProductosCriticos ?? 0) }} productos
      </span>
    </div>

    @if (loading) {
      <p class="text-sm text-gray-500">Cargando...</p>
    } @else if (alertas?.stockCritico?.productos?.length) {
      <div class="space-y-3 mb-4">
        @for (producto of productosCriticosPreview; track producto.productoId) {
          <div class="flex items-center justify-between text-sm">
            <span class="text-gray-900">{{ producto.nombre }}</span>
            <span class="font-medium text-red-600">{{ formatStock(producto.stockActual) }}</span>
          </div>
        }
      </div>
      @if (hayMasProductosCriticos) {
        <button
          pButton
          type="button"
          label="Ver más"
          icon="pi pi-external-link"
          class="p-button-text p-button-sm w-full mb-4"
          (click)="abrirModalStockCritico()"
        ></button>
      }
    } @else if ((alertas?.stockCritico?.totalProductosCriticos ?? -1) === 0) {
      <p class="text-sm text-gray-500 mb-4">No hay productos con stock crítico</p>
    }
  </div>

  <!-- Separador -->
  <div class="border-t border-gray-200 mb-6"></div>

  <!-- Sin Rotación -->
  <div>
    <div class="flex items-center gap-3 mb-4">
      <div class="flex items-center gap-2">
        <i class="pi pi-clock text-yellow-600"></i>
        <span class="font-medium text-yellow-900">Sin Rotación</span>
      </div>
      <span
        class="inline-block bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded-full"
      >
        {{ loading ? '...' : (alertas?.sinRotacion?.totalProductosSinRotacion ?? 0) }} productos
      </span>
    </div>

    @if (loading) {
      <p class="text-sm text-gray-500">Cargando...</p>
    } @else if (alertas?.sinRotacion?.productos?.length) {
      <div class="space-y-3 mb-4">
        @for (producto of productosSinRotacionPreview; track producto.productoId) {
          <div class="flex items-center justify-between text-sm">
            <span class="text-gray-900">{{ producto.nombre }}</span>
            <span class="font-medium text-yellow-600">{{ formatDiasSinVenta(producto.diasSinVenta) }}</span>
          </div>
        }
      </div>
      @if (hayMasProductosSinRotacion) {
        <button
          pButton
          type="button"
          label="Ver más"
          icon="pi pi-external-link"
          class="p-button-text p-button-sm w-full mb-4"
          (click)="abrirModalSinRotacion()"
        ></button>
      }
    } @else if ((alertas?.sinRotacion?.totalProductosSinRotacion ?? -1) === 0) {
      <p class="text-sm text-gray-500 mb-4">No hay productos sin rotación</p>
    }
  </div>
</div>

<!-- Modal Stock Crítico - lista completa -->
<p-dialog
  [(visible)]="mostrarModalStockCritico"
  header="Stock Crítico - Todos los productos"
  [modal]="true"
  [style]="{ width: 'min(450px, 95vw)' }"
  [contentStyle]="{ overflow: 'hidden', display: 'flex', 'flex-direction': 'column' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="true"
  (onHide)="cerrarModalStockCritico()"
>
  <div class="flex flex-col gap-3" style="max-height: 60vh; overflow-y: auto;">
    @for (producto of (alertas?.stockCritico?.productos ?? []); track producto.productoId) {
      <div class="flex items-center justify-between text-sm py-2 px-3 rounded-lg hover:bg-gray-50">
        <span class="text-gray-900 font-medium">{{ producto.nombre }}</span>
        <span class="font-medium text-red-600">{{ formatStock(producto.stockActual) }}</span>
      </div>
    }
  </div>
  <ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      label="Cerrar"
      icon="pi pi-times"
      class="p-button-text"
      (click)="cerrarModalStockCritico()"
    ></button>
  </ng-template>
</p-dialog>

<!-- Modal Sin Rotación - lista completa -->
<p-dialog
  [(visible)]="mostrarModalSinRotacion"
  header="Sin Rotación - Todos los productos"
  [modal]="true"
  [style]="{ width: 'min(450px, 95vw)' }"
  [contentStyle]="{ overflow: 'hidden', display: 'flex', 'flex-direction': 'column' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="true"
  (onHide)="cerrarModalSinRotacion()"
>
  <div class="flex flex-col gap-3" style="max-height: 60vh; overflow-y: auto;">
    @for (producto of (alertas?.sinRotacion?.productos ?? []); track producto.productoId) {
      <div class="flex items-center justify-between text-sm py-2 px-3 rounded-lg hover:bg-gray-50">
        <span class="text-gray-900 font-medium">{{ producto.nombre }}</span>
        <span class="font-medium text-yellow-600">{{ formatDiasSinVenta(producto.diasSinVenta) }}</span>
      </div>
    }
  </div>
</p-dialog>
