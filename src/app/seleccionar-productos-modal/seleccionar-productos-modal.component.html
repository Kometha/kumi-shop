<div class="seleccionar-productos-modal">
  <!-- Descripción -->
  <div class="modal-description mb-4">
    <p class="text-sm text-gray-600">Selecciona uno o más productos para agregar al pedido</p>
  </div>

  <!-- MultiSelect de Productos -->
  <div class="form-group mb-4">
    <label class="form-label">Productos *</label>
    <p-multiSelect
      [(ngModel)]="productosSeleccionadosList"
      (ngModelChange)="onProductosSeleccionadosChange()"
      [options]="productosDisponibles"
      appendTo="body"
      optionLabel="producto"
      placeholder="Seleccione productos"
      [loading]="loadingProductos"
      [style]="{'width':'100%'}"
      [displaySelectedLabel]="true"
      [selectedItemsLabel]="selectedItemsLabel"
      [maxSelectedLabels]="3"
      [showToggleAll]="true"
    >
      <ng-template let-product pTemplate="item">
        <div class="flex items-center gap-3">
          <p-image
            [src]="getProductImageUrl(product)"
            [preview]="false"
            [alt]="product.producto"
            width="40"
            height="40"
            styleClass="product-image-preview-small"
            [style]="{ 'object-fit': 'cover', 'border-radius': '4px' }"
          >
          </p-image>
          <div>
            <div class="font-medium">{{ product.producto }}</div>
            <div class="text-sm text-gray-500">{{ formatCurrency(product.precio) }} | Stock: {{ product.stock }}</div>
          </div>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>

  <!-- Tabla de productos seleccionados con cantidades -->
  @if (productosConCantidad.length > 0) {
    <div class="productos-cantidad-table mb-6">
      <h4 class="text-sm font-semibold text-gray-700 mb-3">Cantidades por producto:</h4>
      <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="text-left p-3 text-xs font-semibold text-gray-600">Producto</th>
              <th class="text-center p-3 text-xs font-semibold text-gray-600">Stock</th>
              <th class="text-center p-3 text-xs font-semibold text-gray-600">Cantidad</th>
            </tr>
          </thead>
          <tbody>
            @for (item of productosConCantidad; track item.producto.id) {
              <tr class="border-t border-gray-200">
                <td class="p-3 font-medium">{{ item.producto.producto }}</td>
                <td class="p-3 text-center font-semibold">{{ item.producto.stock }}</td>
                <td class="p-3 text-center">
                  <p-inputNumber
                    [(ngModel)]="item.cantidad"
                    [min]="1"
                    [max]="item.producto.stock"
                    [style]="{'width': '60px', 'height': '28px'}"
                    [showButtons]="true"
                    buttonLayout="horizontal"
                    [inputStyle]="{'width': '30px', 'height': '28px', 'padding': '2px 4px', 'font-size': '0.75rem', 'text-align': 'center'}"
                  ></p-inputNumber>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }

  <!-- Botones de Acción -->
  <div class="modal-footer flex justify-end gap-3 pt-4 border-t border-gray-200">
    <button
      pButton
      type="button"
      label="Cancelar"
      class="p-button-text"
      (click)="onHide()"
    >
    </button>
    <button
      pButton
      type="button"
      label="Finalizar"
      class="p-button-success"
      [disabled]="productosSeleccionadosList.length === 0"
      (click)="finalizarSeleccionProductos()"
    >
    </button>
  </div>
</div>

