<div class="add-product-modal">
  <!-- Descripción -->
  <div class="modal-description mb-6">
    <p class="text-sm text-gray-600">Completa la información del producto para agregarlo al inventario</p>
  </div>

  <!-- Sección de Imagen -->
  <div class="section mb-6">
    <h3 class="section-title text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">
      IMAGEN DEL PRODUCTO
    </h3>

    <div class="image-upload-container flex justify-center">
      <div
        class="upload-area"
        [class.has-image]="previewImage"
        (click)="!previewImage && fileInput.click()"
        (drop)="onDrop($event)"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        [class.drag-over]="isDragging">

        <input
          #fileInput
          type="file"
          hidden
          accept="image/jpeg,image/jpg,image/png,image/gif"
          (change)="onFileSelected($event)">

        @if (!previewImage) {
          <div class="upload-placeholder">
            <i class="pi pi-upload text-3xl text-gray-400 mb-2"></i>
            <p class="text-gray-700 font-medium">Subir Imagen</p>
            <p class="text-sm text-gray-500 mt-1">JPG, PNG o GIF (máx. 5MB)</p>
          </div>
        }

        @if (previewImage) {
          <div class="image-preview" (click)="viewImage()">
            <img [src]="previewImage" alt="Preview" class="uploaded-image">
            <button
              type="button"
              class="remove-image"
              (click)="removeImage($event)">
              <i class="pi pi-times"></i>
            </button>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Información Básica -->
  <div class="section mb-6">
    <h3 class="section-title text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">
      INFORMACIÓN BÁSICA
    </h3>

    <div class="form-group mb-4">
      <label class="form-label">Código de Producto</label>
      <input
        type="text"
        pInputText
        [(ngModel)]="product.numero_codigo_barra"
        placeholder="Ej: PROD-001"
        class="w-full">
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div class="form-group">
        <label class="form-label">Nombre del Producto *</label>
        <input
          type="text"
          pInputText
          [(ngModel)]="product.nombre"
          placeholder="Ej: Sofá Moderno 3 Plazas"
          class="w-full">
      </div>

      <div class="form-group">
        <label class="form-label">Stock *</label>
        <p-inputNumber
          [(ngModel)]="product.stock"
          [min]="0"
          placeholder="0"
          [style]="{'width':'100%'}">
        </p-inputNumber>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mt-4">
      <div class="form-group">
        <label class="form-label">Descripción</label>
        <input
          type="text"
          pInputText
          [(ngModel)]="product.descripcion"
          placeholder="Ingrese descripción"
          class="w-full"
          style="resize: none; width: 100%;">
      </div>

      <div class="form-group">
        <label class="form-label">Categoría *</label>
        <p-dropdown
          [(ngModel)]="product.categoriaId"
          [options]="categorias"
          optionLabel="nombre"
          optionValue="id"
          placeholder="Seleccione una categoría"
          [loading]="loadingCategorias"
          [style]="{'width':'100%'}">
        </p-dropdown>
      </div>
    </div>
  </div>

  <!-- Precios y Márgenes -->
  <div class="section mb-6">
    <h3 class="section-title text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">
      PRECIOS Y MÁRGENES
    </h3>

    <div class="grid grid-cols-2 gap-4">
      <div class="form-group">
        <label class="form-label">Costo del Producto (USD) *</label>
        <p-inputNumber
          [(ngModel)]="product.costo"
          mode="currency"
          currency="USD"
          locale="en-US"
          [minFractionDigits]="2"
          placeholder="0.00"
          [style]="{'width':'100%'}">
        </p-inputNumber>
        @if (product.costo && product.costo > 0) {
          <p class="text-xs text-gray-500 mt-1">
            ≈ {{ formatLempiras(convertirCostoALempiras()) }}
          </p>
        }
      </div>

      <div class="form-group">
        <label class="form-label">Precio de Venta *</label>
        <p-inputNumber
          [(ngModel)]="product.precioVenta"
          mode="currency"
          currency="HNL"
          locale="es-HN"
          [minFractionDigits]="2"
          placeholder="0.00"
          [style]="{'width':'100%'}">
        </p-inputNumber>
      </div>
    </div>

    @if (product.costo && product.precioVenta) {
      <div class="margin-info mt-3 p-3 bg-gray-50 rounded-lg">
        <p class="text-sm text-gray-600">
          Margen de ganancia:
          <span class="font-semibold text-gray-900">
            {{ calculateMargin() }}%
          </span>
        </p>
      </div>
    }
  </div>

  <!-- Botones de Acción -->
  <div class="modal-footer flex justify-end gap-3 pt-4 border-t border-gray-200">
    <button
      pButton
      type="button"
      label="Cancelar"
      class="p-button-text"
      (click)="onCancel()">
    </button>
    <button
      pButton
      type="button"
      [label]="isEditMode ? 'Actualizar Producto' : 'Agregar Producto'"
      class="p-button-primary"
      [loading]="loading"
      [disabled]="loading"
      (click)="onSave()">
    </button>
  </div>
</div>

<!-- Image Viewer Modal -->
@if (showImageViewer) {
  <div class="image-viewer-overlay" (click)="closeImageViewer()">
    <div class="image-viewer-container" (click)="$event.stopPropagation()">
      <button
        type="button"
        class="close-viewer"
        (click)="closeImageViewer()">
        <i class="pi pi-times"></i>
      </button>
      <img [src]="previewImage" alt="Vista completa" class="viewer-image">
    </div>
  </div>
}
